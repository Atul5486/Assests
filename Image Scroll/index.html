<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Image Scroller</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
</head>
  <body>
    <div class="w-full bg-zinc-900 ">
      <div class="parent relative top-0 left-0 w-full h-[700vh] bg-zinc-800">
        <div class="sticky top-0 left-0 w-full h-screen overflow-x-hidden">
          <canvas id="frame w-full h-screen"></canvas>
        </div>
      </div>
    </div>

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.13.0/gsap.min.js"
      integrity="sha512-NcZdtrT77bJr4STcmsGAESr06BYGE8woZdSdEgqnpyqac7sugNO+Tr4bGwGF3MsnEkGKhU2KL2xh6Ec+BqsaHA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.13.0/ScrollTrigger.min.js" integrity="sha512-P2IDYZfqSwjcSjX0BKeNhwRUH8zRPGlgcWl5n6gBLzdi4Y5/0O4zaXrtO4K9TZK6Hn1BenYpKowuCavNandERg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script>
        const canvas=document.querySelector("canvas");
        const context=canvas.getContext("2d");
        
      const frame = {
        currentIndex: 0,
        maxIndex: 382,
      };
      let imageLoaded=1;
      let images=[];
      function preLoadImage() {
        for (let i = 1; i <= frame.maxIndex; i++) {
          let imageUrl = `./Images/frame_${i.toString().padStart(4, "0")}.jpeg`;
          let img=new Image();
          img.src=imageUrl;
          img.onload=()=>{
              if(imageLoaded===frame.maxIndex){
                  loadImage(frame.currentIndex)
                  startAnimation();
                }
            images.push(img)
            imageLoaded++;
          }
        }
      }
      
      function loadImage(index){
        if(index>=0 && index<=frame.maxIndex){
            const img=images[index]

            canvas.width=window.innerWidth;
            canvas.height=window.innerHeight;

            const scaleX=canvas.width/img.width;
            const scaleY=canvas.height/img.height;

            const scale=Math.max(scaleX,scaleY)

            const newWidth=img.width*scale;
            const newHeight=img.height*scale;

            const offsetX=(canvas.width-newWidth)/2;
            const offsetY=(canvas.height-newHeight)/2;


            context.clearRect(0,0,canvas.width,canvas.height)
            context.imageSmoothingQuality="high"
            context.imageSmoothingEnabled=true 
            context.drawImage(img,offsetX,offsetY,newWidth,newHeight)
            frame.currentIndex=index
        }
      }
    
      function startAnimation(){
        const tl=gsap.timeline({
            scrollTrigger:{
                trigger:".parent",
                start:"top top",
                scrub:2,
                end:"bottom bottom",
            }
        })

        tl.to(frame,{
            currentIndex:frame.maxIndex,
            onUpdate:function(){
                loadImage(Math.floor(frame.currentIndex))
            }
        })
      }
      preLoadImage();
    </script>
  </body>
</html>
